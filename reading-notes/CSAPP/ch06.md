# **存储器层次结构**
***


## **1. 存储技术**
> ### **1.1 随机访问存储器**
    分为静态和动态的; 静态RAM(SRAM)比动态RAM(DRAM)更快; SRAM用来作为高速缓存
    存储器, DRAM用来作为主存以及图形系统的帧缓存区;
    1. SRAM将每个位存储在一个双稳态的存储器单元里;
    2. DRAM将每个位存储为对一个电容的充电;
    3. 增强的DRAM
        * 快页模式DRAM(FPM DRAM), 允许对同一行连续地访问可以直接从行缓冲区得
          到服务;
        * 扩展数据输出DRAM(EDO DRAM), 是FPM DRAM的一个增强的形式, 允许单独的
          CAS信号在时间上靠得更紧密一点;
        * 同步DRAM(SDRAM), 用与驱动存储控制器相同的外部时钟信号的上升沿来代
          替许多这样的控制信号;
        * 双倍数据速率同步DRAM(DDR SDRAM), 是对SDRAM的一种增强, 通过使用两个
          时钟沿作为控制信号, 从而使DRAM的速度翻倍;
        * 视频RAM(VRAM), 在图形系统的帧缓冲区中;
    4. 断电后, DRAM和SRAM会丢失它们的信息, 非易失性存储器即使在断电后也仍然
       保存着它们的信息(ROM);
        * PROM(可编程ROM), 只能被编程一次;
        * EPROM(可擦写可编程ROM), 能够被擦除和重编程;
        * 闪存是一类非易失性存储器; (SSD, 固态硬盘)能提供相当于传统旋转磁盘
          更快速、更强健和更低能耗的选择;
    5. 访问主存
        * 数据流通过成为总线的共享电子电路在处理器和DRAM主存之间来来回回; 每
          次CPU和主存之间的数据传送都是通过一系列步骤来完成的(总线事务, 读事
          务, 写事务);

> ### **1.2 磁盘存储**
    1) 磁盘构造
        * 磁盘由盘片构成;
        * 每盘片有两面或者称为表面, 表面覆盖着磁性记录材料;
        * 盘片中央有一个可旋转的主轴, 使得盘片以固定的旋转速率选择;
    2) 磁盘容量
        * 一个磁盘上可以记录的最大位数称为它的最大容量;
        * 记录密度: 磁道一英寸的段中可以放入的位数;
        * 磁道密度: 从盘片中心出发半径上一英寸的段内可以有的磁道数;
        * 面密度: 记录密度与磁道密度的乘积;
    容量 = 字节数/扇区*平均盘区数/磁道*磁道数/表面*表面数/盘片*盘片数/磁盘
    3) 磁盘操作
        * 用读/写头来读写存储在磁性表面的位, 而读写头连接到一个传动臂的一端;
        * 驱动器可以将读/写头定位在盘面的任何磁道上, 这就是寻道;
        * 一旦读/写头定位到了期望的磁道上, 就可以读写数据了;
        * 有多个盘片的磁盘每个盘面都一个独立的读写头;

> ### **1.3 固态硬盘**
    1) 一种基于闪存的存储技术, 在某些状况下是传统选择磁盘的极有吸引力的替代
       产品;
    2) 顺序读写性能相当, 顺序读比顺序写稍微快一点; 逻辑顺序访问逻辑块时, 写
       比读慢一个数量级;
    3) 随机写很慢的原因:
        * 擦除块需要相对较长的时间;
        * 如果写操作试图修改一个包含已经有数据的页, 那这个块中所有带有用数据
          的必须被拷贝到一个新的块, 然后再对该页进行写;

> ### **1.4 存储技术趋势**
    1) 不同的存储技术有不同的价格和性能折中;
    2) 不同存储技术的价格和性能属性以截然不同的速率变化着;
    3) DRAM和磁盘的性能滞后于CPU的性能;


## **2. 局部性**
    1) 局部性原理(Principle of locality): 一个编写良好的计算机程序常常具有良
       好的局部性; 它们倾向于引用邻近于其他最近引用过的数据项的数据项, 或最
       近引用过的数据项本身;
> ### **2.1 对程序数据引用的局部性**
    1) 引用模式中随着步长的增加, 空间局部性下降;
    2) 对于多维数组, 内存循环读取一行的元素, 然后再读第二行; 这样就得到一个
       步长为1的引用模式和良好的空间局部性;

> ### **2.2 局部性小结**
    1) 重复引用同一个变量的程序有良好的时间局部性;
    2) 对于具有步长为k的引用模式的程序, 步长越小, 空间局部性越好;
    3) 对于取指令来说, 循环有好的时间和空间局部性; 循环体越小, 循环迭代次数
       越多, 局部性越好;


## **3. 存储器层次结构**
> ### **3.1 存储器层次结构中的缓存
    1) 高速缓存是一个小而快速的存储设备, 作为存储在更大, 也更慢的设备中的数
       据对象的缓冲区域;
    2) 当程序需要第k+1层的某个数据对象d时, 首先在当前存储在第k层的一个块中查
       找d, 如果d刚好在缓存第k层中, 那就是缓存命中;
    3) 如果第k层中没有缓存数据对象d, 那么就是缓存不命中;
    4) 一个空的缓存就是冷缓存, 这就是强制不命中或冷不命中;

> ### **3.2 存储器层次结构概念小结**
    1) 利用时间局部性: 由于时间局部性, 同一数据对象可能会被多次使用;
    2) 利用空间局部性: 块通常包含有多个数据对象;


## **4. 高速缓存存储器**
    1) 较大的高速缓存可能会增加命中时间;
    2) 块越大则高速缓存行数越少, 会损害时间局部性比空间局部性更好的程序的命
       中率;
    3) 较高的相关联度降低了高速缓存由于冲突不命中出现抖动的可能性; 但会造成
       较高的成本;
    4) 写回高速缓存引起的传送比较少; 越往层次结构下层走, 传送时间增加, 减少
       传送的数量就变得更加重要; 高速缓存越往下层, 越可能使用写回而非直写;


## **5. 编写高速缓存友好的代码**
    1) 局部性好的程序更容易有较低的不命中率, 则运行得更快;
    2) 集中在核心函数中的循环上, 忽略其他部分;
    3) 在每个循环内部缓存不命中数量最小: 其他条件相同的情况下, 不命中率较低
       的循环运行得更快;
    4) 对局部变量反复引用是好的, 编译器能将它们缓存在寄存器文件中;
    5) 步长为1的引用模式是好的, 存储器层次结构中所有层次上的缓存都是将数据存
       储为连续的块;
