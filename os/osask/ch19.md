# **应用程序** #
***


## **1. cat命令** ##
    1) 制作一个"cat 文件名"会显示文件的内容的命令
    2) clustno的值相差1, 在磁盘映像中文件的位置就相差一个扇区, 也就是512字节
    3) 由于clustno = 0x0002, 其地址是0x004200; 那么可以推算出clustno=0x0000
       的时候其地址是0x003e00
    4) 磁盘映像中的地址 = clustno * 512 + 0x003e00
    5) 我们显示出来的文本, 会有一些乱码的现象, 主要是由于我们没有处理换行符
       以及制表符等特殊字符
    6) 具体例子请参见./os-src/toyos94/


## **2. cat命令改良版** ##
    1) 需要支持特殊字符:
        * 0x09  -> 制表符, 显示空格知道x被4整除为止
        * 0x0a  -> 换行符, 换行
        * 0x0d  -> 回车符, 忽略
    2) 制表符应该是当前位置到下一个制表位之间填充空格
    3) 对于回车符, 我们将0x0a作为换行加回车, 忽略掉0x0d 
    4) 在制表符的处理中, 我们使用了 if (0 == ((x - 8) & 0x1f)) break;
       来表示被32整除则跳出循环;
       因为窗口的边框需要减去8, 1个字符的宽度是8, 每个制表位相隔4个字符, 也
       就是x - 8应该为0, 32, 64, 96, 128, 160, 192, 224, 也就是被32除后余数
       为0的数; 对于这些很整的数字, 我们使用0x1f来与就可以判定了
    5) 具体例子请参见./os-src/toyos95/



## **3. 对FAT的支持** ##
    1) 目前我们的cat命令, 不能支持大于512字节的文件, 文件大了, 可能出现显示
       其他文件的内容
    2) 对于文件的下一段存放在哪里, 在磁盘中是有记录的, 我们只需要分析这个记
       录就可以正确读取文件的内容
    3) 磁盘中对文件的记录存放在0柱面, 0磁头, 2扇区开始的9个扇区中, 也就是相
       当于0x000200 ~ 0x0013ff; 这个记录就是FAT(file allocation table), 就是
       文件分配表
    4) 一般来说, 我们读到扇区号为ff8~fff表示读到了文件尾
    5) 具体例子请参见./os-src/toyos96/
