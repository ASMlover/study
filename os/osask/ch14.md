# **高分辨率以及键盘输入** #
***


## **1. 性能测试** ##
    1) 我们使用大量的定时器, 来测试性能是否提升, 我们可以在50天后追加490个定
       时器
    2) 具体例子请参见./os-src/toyos67/


## **2. 提高分辨率** ##
    1) 高分辨率的利用方法因显卡的不同而不同
    2) 直接在toyos.s中修改画面模式的设定即可
    3) 给ax赋值0x4f02, 给bx赋值画面模式号码, 这样就可以切换到高分辨率模式了
    4) VESA协会制作了专门的BIOS来设定分辨率, 这个BIOS被称作"VESA BIOS 
       extension"(VESA-BIOS扩展, VBE); 利用它就可以使用显卡的高分辨率功能了;
        * 切换到不使用VBE画面的时候使用"ah = 0; al = 画面模式号码";
        * 切换到VBE画面模式时"ax = 0x4f02; bx = 画面模式号码";
    5) VBE画面模式号码:
        * 0x101 - 640 * 480 * 8bit 彩色
        * 0x103 - 800 * 600 * 8bit 彩色
        * 0x105 - 1024 * 768 * 8bit 彩色
        * 0x107 - 1280 * 1024 * 8bit 彩色
        将这些值加上0x4000, 赋值到bx即可
    6) 具体例子请参见./os-src/toyos68/



## **3. 提高分辨率** ##
    1) 前面我们提高分辨率的方法只是在qemu中使用的, 我们让它在真机上显示高分
       辨率
    2) 我们不能断定机器上使用的是什么样的显卡, 有的尚未与VESA合作, 所有我们
       应该先确认VBE是否存在
        * 给es赋值0x9000, di赋值为0, ax赋值为0x4f00, 再执行int 0x10;
        * 如果有VBE, 那么ax会变成0x004f
        (之所以要对es和di赋值, 因为显卡能利用的VBE信息要写入到内存中以es:di
         开始的512字节中)
    3) 检查VBE版本, 如果VBE不是2.0以上则不能使用高分辨率
    4) 我们检查VBEMODE指定模式的画面可不可以使用, 我们对ax进行确认, 如有ax的
       值是0x004f意外的值则表示指定的画面模式不能使用
    5) VBE画面模式
        * word  [es:di + 0x00] - 模式属性, bit7不是1就不好办(能加上0x4000)
        * word  [es:di + 0x12] - x的分辨率
        * word  [es:di + 0x14] - y的分辨率
        * byte  [es:di + 0x19] - 颜色数, 必须是8 
        * byte  [es:di + 0x1b] - 颜色的指定方法, 必须是4(4是调色板模式)
        * dword [es:di + 0x28] - VRAM的地址
    6) 我们需要确认
        * 颜色数是否是8 
        * 是否为调色板模式
        * 画面模式号码可否加上0x4000再进行指定
    7) 确认了这些信息后就可以使用指定的VBE画面模式了, 然后进行画面模式切换
    8) 具体例子请参见./os-src/toyos69/



## **4. 键盘输入** ##
    1) 键盘按下键的数值表
        * 00 - 没有被分配使用
        * 01 - ESC
        * 02 ~ 0A - 主键盘1 ~ 主键盘9
        * 0B - 主键盘0 
        * 0C - 主键盘-
        * 0D - 主键盘^(英语键盘是=)
        * 0E - 退格键
        * 0F - TAB
        * 10 ~ 19 - (QWERTYUIOP)
        * 1A - @(英语键盘是[)
        * 1B - [(英语键盘是])
        * 1C - 主键盘Enter
        * 1D - 左Ctrl
        * 1E ~ 26 - (ASDFGHJKL)
        * 27 - ;
        * 28 - :(英语键盘是"'")
        * 29 - 全角.半角(英语键盘是`)
        * 2A - 左Shift
        * 2B - ](英语键盘是backslash-反斜杠\)
        * 2C ~ 32 - (ZXCVBNM)
        * 33 - ,
        * 34 - .
        * 35 - /
        * 36 - 右Shift
        * 37 - 数字键的* 
        * 38 - 左Alt
        * 39 - Space
        * 3A - CapsLock
        * 3B ~ 44 - (F1 F2 F3 F4 F5 F6 F7 F8 F9 F10)
        * 45 - NumLock
        * 46 - ScrollLock
        * 47 ~ 49 - (数字键7/8/9)
        * 4A - 数字键-
        * 4B ~ 4D - (数字键4/5/6)
        * 4E - 数字键+
        * 4F ~ 52 - (数字键1/2/3/0)
        * 53 - 数字键.
        * 54 - SqReq|PrintScreen
        * 55 ~ 56 - 保留?
        * 57 ~ 58 - (F11 F12)
        * 59 ~ 6F - 保留? 
        * 70 - 平假名(日文键盘)
        * 71 ~ 72 - 保留? 
        * 73 - _
        * 74 ~ 78 - 保留?
        * 79 - 变换(日文键盘)
        * 7A - 保留?
        * 7B - 无变换(日文键盘)
        * 7C - 保留?
        * 7D - \
        * 7E ~ 7F - 保留?
    2) 不再显示计数(不测试性能了), 充分让CPU hlt, 并显示出所按的键(只测试A)
    3) 具体例子请参见./os-src/toyos70/
