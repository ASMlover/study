# **命令行窗口** #
***


## **1. 闲置任务** ##
    1) 我们应该让所有level中都没有任务的时候, 让系统处于hlt 
    2) 我们设置一个闲置任务, 让它处于最下层
    3) 具体例子请参见./os-src/toyos86/


## **2. 创建命令行窗口** ##
    1) 我们可以将命令行窗口创建成一个单独的任务, 这样我们就可以创建更多的命
       令行窗口
    2) 具体例子请参见./os-src/toyos87/


## **3. 切换输入窗口** ##
    1) 我们加上命令(TAB)以便可以切换到命令行窗口;
    2) 其实我们所谓的切换窗口就是改变一下窗口标题栏的颜色即可
    3) 具体例子请参见./os-src/toyos88/


## **4. 实现字符输入** ##
    1) 要实现在Console窗口输入字符, 只需要向console_task的FIFO缓冲区发送数据
       就可以了
    2) 对于这个任务如何知道FIFO缓冲区, 我们直接将这个对象放到task对象里面就
       可以实现了
    3) 具体例子请参见./os-src/toyos89/


## **5. 符号的输入** ##
    1) 虽然我们已经可以输入字符了, 但是对于一些符号(!/%)依旧不能输入
    2) 要实现这些字符的输入, 我们必须处理shift键
                      按下      抬起
        左Shift       0x2a      0xaa
        右Shift       0x36      0xb6
        这样我们就可以准备一个变量, L-Shift按下的时候为1, R-Shift按下的时候
        为2, 两个都按下的时候为3, 都没有按下的时候为0; 
        这样, 我们可以在准备一个表, 用来表示Shift按下的时候的字符, 这样这个
        变量为0, 我们就使用原来的表; 这个变量不为0, 则为我们准备的按下Shift
        时的表
    3) 具体例子请参见./os-src/toyos8a/


## **6. 大写字母与小写字母** ##
    1) 要实现大写字母小写字母的输入, 我们需要同时判断Shift的状态及CapsLock的
       状态
        * CapsLock(up) & Shift(up)      => 小写字母
        * CapsLock(up) & Shift(down)    => 大写字母
        * CapsLock(down) & Shift(up)    => 大写字母
        * CapsLock(down) & Shift(down)  => 小写字母
    2) 需要转换大小写字母的条件
        * 输入的字符是英文字母
        * CapsLock(up) & Shift(up)
        * CapsLock(down) & Shift(down)
    3) CapsLock的状态BIOS知道, 我们可以从binfo->leds中取得
        * binfo->leds的第4位  => ScrollLock的状态
        * binfo->leds的第5位  => NumLock的状态
        * binfo->leds的第6位  => CapsLock的状态 
    4) 最后测试, 在虚拟机上CapsLock貌似无效
    5) 具体例子请参见./os-src/toyos8b/


## **7. 对各种锁定键的支持** ##
    1) 根据编码表:
        * CapsLock    => 0x3a
        * NumLock     => 0x45
        * ScrollLock  => 0x46
    2) 对NumLock和CapsLock等led的控制, 可以采用如下方法向键盘发送指令和数据:
        * 读取状态寄存器, 等待bit 1的值变为0 
        * 向数据输出(0x60)写入要发送的1个字节数据
        * 等待键盘返回1个字节的信息, 这和等待键盘输入所采用的方法相同
          (用IRQ等待或者轮询状态寄存器bit 1的值直到其变为0即可)
        * 返回信息如果是0xfa, 表明1个字节的数据已经成功发送到键盘; 如为0xfe
          则表明发送失败, 需要返回第一个步骤重新来过
    3) 要控制led的状态, 需要按上述方法执行两次, 想键盘发送EDxx数据;xx的bit 0
       代表ScrollLock, bit 1代表NumLock, bit 2代表CapsLock(0表示熄灭, 1表示
       点亮); bit 3 ~ 7保留, 置0即可 
    4) 我们可以设置一个变量用来保存向键盘控制器发送数据的状态, 当它为-1表示
       可以发送指令, 当它不为-1时表示键盘控制器正在等待发送的数据, 这个时候
       发送的数据被保存到这个变量中
    5) 具体例子请参见./os-src/toyos8c/
