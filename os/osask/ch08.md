# **鼠标控制与32位模式切换** #
***


## **1. 鼠标解读(解读鼠标数据)** ##
    1) 我们现在需要做的就是, 解读从鼠标返回来的数据, 解析鼠标是怎么移动的, 
       然后结合鼠标的动作, 让鼠标指针动起来
    2) 首先将从鼠标那儿读到的0xfa丢弃, 然后将紧接着的3个字节接收到组合到一起
       形成一组鼠标数据; 然后循环
    3) 具体例子请参见./os-src/toyos35/


## **2. 模块整理** ##
    1) 将解析鼠标数据的部分整理成一个单独的函数模块
    2) 具体例子请参见./os-src/toyos36/


## **3. 鼠标解读** ##
    1) 我们在接受鼠标传递过来的第一个字节的时候, 应该判断其对鼠标移动有反应
       的部分是在0~3的范围内; 同时还需要判断第一字节对点击有反应的部分是在
       8~f的范围内
    2) 鼠标的状态存在buf[0]的低3位, 鼠标的坐标放在buf[1]和buf[2]中; 但是需要
       使用buf[0]中对鼠标移动有反应的几位信息, 将x和y的第8位以及8位以后全部
       设置为1, 或者全部保持为0 
    3) 具体例子请参见./os-src/toyos37/


## **4. 移动鼠标指针** ##
    1) 首先隐藏鼠标指针, 然后在鼠标指针的坐标上, 加上解读到的位移量, 这样就
       得到了鼠标的新位置, 再重新显示鼠标即可
    2) 具体例子请参见./os-src/toyos38/


## **5. 通往32位模式之路** ##
    1) 在初始化PIC之前, 不应该有中断发生, 初始化的时候也不许有中断发生, 所以
       完成PIC的初始化之前需要禁止所有的中断
    2) 对于GDT, 将CR0这一特殊的32位寄存器的值带入eax, 并将最高位设置为0, 最
       低位设置为1, 再将这个值返回给CR0寄存器; 这样便完成了模式转换, 进入到
       保护模式
    3) toyos内存分布
        0x00000000 ~ 0x000fffff: 在启动中会多次使用, 但之后就变空(1MB)
        0x00100000 ~ 0x00267fff: 用于保存软盘的内容(1440KB)
        0x00268000 ~ 0x0026f7ff: 空(30KB)
        0x0026f800 ~ 0x0026ffff: IDT(2KB)
        0x00270000 ~ 0x0027ffff: GDT(64KB)
        0x00280000 ~ 0x002fffff: bootpack.hrb(512KB)
        0x00300000 ~ 0x003fffff: 栈以及其他
        0x00400000 ~           : 空
        在0x00000000 ~ 0x000fffff中还包含BIOS以及VRAM等内容
    4) 其他请参见书籍等相关资料
