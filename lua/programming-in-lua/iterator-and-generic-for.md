# **迭代器与泛型for** #
***


## **1. 迭代器与closure** ##
    1) 迭代器是一种可以遍历一种集合中所有元素的机制
    2) 一个closure结构通常涉及两个函数: closure本身和一个用于创建该closure的
       工厂函数


## **2. 泛型for的语义** ##
    1) 泛型for在循环过程内部保存了迭代器函数
    2) 实际泛型for保存了3个值: 一个迭代器函数, 一个恒定状态和一个控制变量
    3) 语法如下:
        for <var-list> in <exp-list> do 
          <body>
        end 
    4) 泛型for做的第一件事情就是对in后面的表达式求值, 这些表达式应该返回3个
       值供for保存: 迭代器函数, 恒定状态和控制变量的初值
    5) 在初始化步骤之后, for会以恒定状态和控制变量来调用迭代器函数, 然后for
       将迭代器函数的返回值赋予变量列表中的变量; 
       如果第一个返回值为nil, 那么循环终止, 否则for就执行它的循环体, 随后再
       次调用迭代器函数, 冰重复这个过程


## **3. 无状态的迭代器** ##
    1) 是一种自身不保存任何状态的迭代器, 因此可以在多个循环中使用同一个无状
       态的迭代器, 避免创建新的closure开销
    2) 在每次迭代中, for循环都会用很定状态和控制变量来调用迭代器函数, 一个无
       状态的迭代器可以根据这两个值来为下次迭代生成下一个元素


## **4. 具有复杂状态的迭代器** ##
    1) 泛型for只提供了一个恒定状态和一个控制变量用于状态的保存
    2) 一个基于closure实现的迭代器会比一个使用table的迭代器更为高效, 因为创
       建一个closure比创建一个table更廉价, 访问非局部的变量也比访问table字段
       更快


## **5. 真正的迭代器** ##
    1) 可以实现真正的迭代器, 可以在迭代器调用中传入一个函数, 来实现真正的迭
       代器
    2) 在调用这类真正迭代器的时候, 还可以使用一个匿名函数作为循环体
